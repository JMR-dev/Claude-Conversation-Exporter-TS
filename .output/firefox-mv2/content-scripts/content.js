var content=(function(){"use strict";const v=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function A(t){return t}const E=[{date:new Date("2024-01-01"),model:"claude-3-sonnet-20240229"},{date:new Date("2024-06-20"),model:"claude-3-5-sonnet-20240620"},{date:new Date("2024-10-22"),model:"claude-3-5-sonnet-20241022"},{date:new Date("2025-02-29"),model:"claude-3-7-sonnet-20250219"},{date:new Date("2025-05-14"),model:"claude-sonnet-4-20250514"},{date:new Date("2025-09-29"),model:"claude-sonnet-4-5-20250929"}];function g(t){if(t.model)return t.model;const n=new Date(t.created_at);for(let e=E.length-1;e>=0;e--){const r=E[e];if(r&&n>=r.date)return r.model}return E[0]?.model}function _(t){if(!t.chat_messages||!t.current_leaf_message_uuid)return[];const n=new Map;t.chat_messages.forEach(o=>{n.set(o.uuid,o)});const e=[];let r=t.current_leaf_message_uuid;for(;r&&n.has(r);){const o=n.get(r);if(!o||(e.unshift(o),r=o.parent_message_uuid,r&&!n.has(r)))break}return e}function C(t){let n="";if(t.content)for(const e of t.content)e.text&&(n+=e.text);else t.text&&(n=t.text);return n}function I(t,n){let e=`# ${t.name||"Untitled Conversation"}

`;n&&(e+=`**Created:** ${new Date(t.created_at).toLocaleString()}
`,e+=`**Updated:** ${new Date(t.updated_at).toLocaleString()}
`,e+=`**Model:** ${g(t)}

`,e+=`---

`);const r=_(t);for(const o of r){const i=o.sender==="human"?"**You**":"**Claude**";e+=`${i}:

`;const s=C(o);s&&(e+=`${s}

`),n&&o.created_at&&(e+=`*${new Date(o.created_at).toLocaleString()}*

`),e+=`---

`}return e}function k(t,n){let e="";n&&(e+=`${t.name||"Untitled Conversation"}
`,e+=`Created: ${new Date(t.created_at).toLocaleString()}
`,e+=`Updated: ${new Date(t.updated_at).toLocaleString()}
`,e+=`Model: ${g(t)}

`,e+=`---

`);const r=_(t);let o=!1,i=!1;for(const s of r){const c=C(s);let a;s.sender==="human"?(a=o?"H":"Human",o=!0):(a=i?"A":"Assistant",i=!0),e+=`${a}: ${c}

`}return e.trim()}function S(t,n,e="application/json"){const r=new Blob([t],{type:e}),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}function h(t,n,e){const r=t.replace(/[^a-z0-9]/gi,"_").toLowerCase().substring(0,50),o=n==="json"?"json":n==="markdown"?"md":"txt",i=e?`_${e.substring(0,8)}`:"";return`${r}${i}.${o}`}const M={matches:["https://claude.ai/*"],cssInjectionMode:"ui",main(){console.log("Claude Conversation Exporter content script loaded");async function t(o,i){const s=`https://claude.ai/api/organizations/${o}/chat_conversations/${i}?tree=True&rendering_mode=messages&render_all_tools=true`,c=await fetch(s,{credentials:"include",headers:{Accept:"application/json"}});if(!c.ok)throw new Error(`Failed to fetch conversation: ${c.status}`);return await c.json()}async function n(o){const i=`https://claude.ai/api/organizations/${o}/chat_conversations`,s=await fetch(i,{credentials:"include",headers:{Accept:"application/json"}});if(!s.ok)throw new Error(`Failed to fetch conversations: ${s.status}`);return await s.json()}async function e(o,i,s,c){console.log("Fetching conversation:",i);const a=await t(o,i);console.log("Conversation data fetched successfully:",a);const f=g(a);a.model=f;let l,d,u;switch(s){case"markdown":l=I(a,c),d=h(a.name||"untitled","markdown",a.uuid),u="text/markdown";break;case"text":l=k(a,c),d=h(a.name||"untitled","text",a.uuid),u="text/plain";break;default:l=JSON.stringify(a,null,2),d=h(a.name||"untitled","json",a.uuid),u="application/json"}console.log("Downloading file:",d),S(l,d,u)}async function r(o,i,s){const c=await n(o);if(console.log(`Fetched ${c.length} conversations`),i==="json"){const l=`claude-all-conversations-${new Date().toISOString().split("T")[0]??"export"}.json`;return console.log("Downloading all conversations as JSON:",l),S(JSON.stringify(c,null,2),l,"application/json"),{count:c.length}}let a=0;const f=[];for(const l of c)try{console.log(`Fetching full conversation ${a+1}/${c.length}: ${l.uuid}`);const d=await t(o,l.uuid);d.model=g(d);let u,x,T;i==="markdown"?(u=I(d,s),x=h(l.name||"untitled","markdown",l.uuid),T="text/markdown"):(u=k(d,s),x=h(l.name||"untitled","text",l.uuid),T="text/plain"),S(u,x,T),a++,await new Promise(F=>setTimeout(F,500))}catch(d){const u=d instanceof Error?d.message:"Unknown error";console.error(`Failed to export conversation ${l.uuid}:`,u),f.push(`${l.name||l.uuid}: ${u}`)}return f.length>0?(console.warn("Some conversations failed to export:",f),{count:a,warnings:`Exported ${a}/${c.length} conversations. Some failed: ${f.join("; ")}`}):{count:a}}(async()=>v.runtime.onMessage.addListener((o,i)=>o.action==="exportConversation"?(console.log("Export conversation request received:",o),(async()=>{try{return await e(o.orgId,o.conversationId,o.format,o.includeMetadata),{success:!0}}catch(s){const c=s instanceof Error?s.message:"Unknown error",a=s instanceof Error?s.stack:void 0;return console.error("Export conversation error:",s),{success:!1,error:c,details:a}}})()):o.action==="exportAllConversations"?(console.log("Export all conversations request received:",o),(async()=>{try{const s=await r(o.orgId,o.format,o.includeMetadata);return{success:!0,count:s.count,warnings:s.warnings}}catch(s){const c=s instanceof Error?s.message:"Unknown error",a=s instanceof Error?s.stack:void 0;return console.error("Export all conversations error:",s),{success:!1,error:c,details:a}}})()):!1))()}};function m(t,...n){}const y={debug:(...t)=>m(console.debug,...t),log:(...t)=>m(console.log,...t),warn:(...t)=>m(console.warn,...t),error:(...t)=>m(console.error,...t)};class b extends Event{constructor(n,e){super(b.EVENT_NAME,{}),this.newUrl=n,this.oldUrl=e}static EVENT_NAME=$("wxt:locationchange")}function $(t){return`${v?.runtime?.id}:content:${t}`}function L(t){let n,e;return{run(){n==null&&(e=new URL(location.href),n=t.setInterval(()=>{let r=new URL(location.href);r.href!==e.href&&(window.dispatchEvent(new b(r,e)),e=r)},1e3))}}}class w{constructor(n,e){this.contentScriptName=n,this.options=e,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=$("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=L(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(n){return this.abortController.abort(n)}get isInvalid(){return v.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(n){return this.signal.addEventListener("abort",n),()=>this.signal.removeEventListener("abort",n)}block(){return new Promise(()=>{})}setInterval(n,e){const r=setInterval(()=>{this.isValid&&n()},e);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(n,e){const r=setTimeout(()=>{this.isValid&&n()},e);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(n){const e=requestAnimationFrame((...r)=>{this.isValid&&n(...r)});return this.onInvalidated(()=>cancelAnimationFrame(e)),e}requestIdleCallback(n,e){const r=requestIdleCallback((...o)=>{this.signal.aborted||n(...o)},e);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(n,e,r,o){e==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),n.addEventListener?.(e.startsWith("wxt:")?$(e):e,r,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),y.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:w.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(n){const e=n.data?.type===w.SCRIPT_STARTED_MESSAGE_TYPE,r=n.data?.contentScriptName===this.contentScriptName,o=!this.receivedMessageIds.has(n.data?.messageId);return e&&r&&o}listenForNewerScripts(n){let e=!0;const r=o=>{if(this.verifyScriptStartedEvent(o)){this.receivedMessageIds.add(o.data.messageId);const i=e;if(e=!1,i&&n?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}}function U(){}function p(t,...n){}const D={debug:(...t)=>p(console.debug,...t),log:(...t)=>p(console.log,...t),warn:(...t)=>p(console.warn,...t),error:(...t)=>p(console.error,...t)};return(async()=>{try{const{main:t,...n}=M,e=new w("content",n);return await t(e)}catch(t){throw D.error('The content script "content" crashed on startup!',t),t}})()})();
content;